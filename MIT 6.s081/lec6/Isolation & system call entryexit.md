#  **Isolation & system call entry/exit** 

## 1. Trap机制

程序运行是完成用户空间和内核空间的切换。每当

- 程序执行系统调用
- 程序出现了类似`page fault`，运算时除0的错误
- 一个设备触发了中断使得当前程序需要响应内核设备驱动



## 2. Trap代码执行流程

跟踪trap

​	修改原文件为`write`

![image-20211211124845294](image/image-20211211124845294.png)

![image-20211211124832327](image/image-20211211124832327.png)

![image-20211211125112250](image/image-20211211125112250.png)

​	查看寄存器信息，`a0`,`a1`和`a2`是shell传递给`write`的三个参数

​	`a0`指文件描述符，`a1`中指向shell要写入的字符缓冲区的指针，`a2`要写入的字符数

![image-20211211130059039](image/image-20211211130059039.png)

使用x命令查看要写入的值，以及`satp`指向的页表地址

![image-20211211130657642](image/image-20211211130657642.png)

在qemu中键入`ctrl + b c`输入`info mem`查看 页表

![image-20211211131224651](image/image-20211211131224651.png)

查看当前指向位置情况，并且指向`ecall`