# Lab0： 网络 预热

​	欢迎来到 CS144：计算机网络简介。在这个预热中，您将在您的计算机上安装 Linux，学习如何通过 Internet 手动执行一些任务，用 C++ 编写一个通过 Internet 获取网页的小程序，并实现（在内存中）网络的关键抽象：写入者和读取者之间的可靠字节流。我们预计此热身将花费您 2 到 6 个小时来完成（未来的实验将花费您更多的时间）。关于实验室作业的三个要点：

- 在深入研究之前阅读整个文档是个好主意
- 在这个由 8 部分组成的实验作业的过程中，您将构建自己对 Internet 的重要部分的实现——路由器、网络接口和 TCP 协议（将不可靠的数据报转换为可靠的字节流），大多数周将建立在您之前完成的工作的基础上，即您在本季度的过程中逐渐建立自己的实施，并且您将在未来几周继续使用您的工作。这使得很难“跳过”检查点
- 实验室文件不是“规范”——这意味着它们不打算以单向方式使用。它们的编写更接近软件工程师从老板或客户那里获得的详细程度。我们希望您能从参加实验室会议并提出澄清问题中受益，如果您发现某些事情有歧义并且您认为答案很重要。（如果您认为某些事情可能没有完全说明，有时事实是这并不重要——您可以尝试一种或另一种方法，看看会发生什么。）

## 0 合作政策

​	编程作业必须是您自己的工作：您必须编写为编程作业提交的所有代码，除了我们作为作业的一部分提供给您的代码。请不要从 Stack Overflow、GitHub 或其他来源复制和粘贴代码。如果您根据在 Web 或其他地方找到的示例编写自己的代码，请在提交的源代码的注释中引用 URL。

​	与他人合作：您不得向其他人展示您的代码、查看其他人的代码或查看前几年的解决方案。您可以与其他学生讨论作业，但不要复制任何人的代码。如果您与其他学生讨论作业，请在您提交的源代码的评论中命名他们。请参阅课程管理讲义了解更多详情，如有任何不清楚之处，请在 Piazza 上询问。

​	Piazza：请随时在 Piazza 上提问，但请不要发布任何源代码。

## 1 环境搭建

## 2 手动联网

​	让我们开始使用网络。您将手动完成两项任务：检索网页（就像 Web 浏览器一样）和发送电子邮件消息（就像电子邮件客户端一样）。这两项任务都依赖于称为可靠双向字节流的网络抽象：您将在终端中键入一个字节序列，并且相同的字节序列最终将以相同的顺序传送到另一台计算机（服务器）上运行的程序。服务器以自己的字节序列进行响应，并将其传送回您的终端。

### 2.1 获取网页

1. 在 Web 浏览器中，访问 http://cs144.keithw.org/hello 并观察结果

2. 现在，您将手动执行浏览器所做的相同操作

    - 在您的 VM 上，运行 `telnet cs144.keithw.org http `。这告诉 telnet 程序在您的计算机和另一台计算机（名为 cs144.keithw.org）之间打开一个可靠的字节流，并在该计算机上运行一个特定的服务：“http”服务，用于超文本传输协议，被万维网使用。

        如果您的计算机已正确设置并在 Internet 上，您将看到

        ![image-20220105133235055](image/image-20220105133235055.png)

    - `GET /hello HTTP/1.1`。这告诉服务器 URL 的路径部分

    - `Host: cs144.keithw.org`。这告诉服务器 URL 的主机部分。 （http:// 和第三个斜杠之间的部分。）

    - `Connection: close `。这告诉服务器你已经完成了请求，它应该在完成回复后立即关闭连接

    - 再按一次 Enter 键： 。这会发送一个空行并告诉服务器您的 HTTP 请求已完成

    - 如果一切顺利，您将看到与浏览器看到的相同的响应，前面是 HTTP 标头，告诉浏览器如何解释响应。

![image-20220105133644266](image/image-20220105133644266.png)

### 2.2 发送给自己邮箱（需要斯坦福账号，暂不演示）

### 2.3 监听和连接

​	您已经了解了可以使用telnet进行的操作：一个客户端程序，该客户端程序与其他计算机上运行的程序建立了传出连接。 现在该尝试做一个简单的服务器了：一种等待客户端连接到它的程序。

1.在一个终端窗口中，在VM上运行netcat -v -l -p 9090。 您应该看到：

```text
user@computer:~$ netcat -v -l -p 9090
Listening on [0.0.0.0] (family 0, port 9090)
```

2.使netcat运行。 在另一个终端窗口中，运行telnet localhost 9090（也在您的VM上）。

3.如果一切顺利，则netcat将打印类似“收到来自localhost 53500的连接！”的信息。

4.现在尝试在终端窗口中输入-netcat（服务器）或telnet（客户端）。

请注意，您在一个窗口中键入的任何内容都会显示在另一个窗口中，反之亦然。

您必须点击才能传输字节。

5.在netcat窗口中，通过键入ctrl -C退出程序。 请注意，telnet程序也会立即退出。

![image-20220105134349451](image/image-20220105134349451.png)

## 3 使用 OS 流套接字编写网络程序

​	在此热身实验的下一部分中，您将编写一个简短的程序，该程序通过Internet来获取网页。 您将利用Linux内核和大多数其他操作系统提供的功能：在两个程序之间创建可靠的双向有序字节流的能力，一个程序在您的计算机上运行，另一个程序在另一台计算机上运行。 Internet（例如，Web服务器，例如Apache或Nginx，或netcat程序）。

**此功能称为流套接字。 对于您的程序和Web服务器，套接字看起来像一个普通的文件描述符（类似于磁盘上的文件，或者类似于stdin或stdout I / O流）。 当连接两个流套接字时，写入一个套接字的任何字节最终将以相同的顺序从另一台计算机上的另一个套接字中输出**。

但是，实际上，互联网不提供可靠的字节流服务。 相反，Internet真正唯一要做的就是尽其最大的努力将称为**Internet数据报**的短数据传递到目的地。 每个数据报都包含一些**元数据（头部）**，这些元数据指定了诸如源地址和目标地址（它来自哪台计算机，以及它指向哪台计算机）之类的内容，以及一些要传递到目标的有效载荷数据（最多约1500字节）。 电脑。

尽管网络尝试传递每个数据报，但实际上，数据报可能会（1）丢失，（2）乱序发送，（3）内容更改后传递，甚至（4）重复并传递不止一次。 通常，连接两端的操作系统都会将“尽力而为数据报”（Internet提供的抽象）转换为“**可靠的字节流**”（应用程序通常需要的抽象）。

两台计算机必须合作，以确保流中的每个字节最终在适当的位置最终传递到另一侧的流套接字。 他们还必须告诉对方他们准备从另一台计算机接受多少数据，并确保发送的数据不超过另一方愿意接受的数据。 所有这些操作都是通过1981年制定的协议达成的，该协议称为传输控制协议或TCP。

在本实验中，您将仅使用操作系统对传输控制协议的先前支持。 **您将编写一个名为“ webget”的程序，该程序将创建一个TCP流套接字，连接到Web服务器并获取一个页面**，就像在本实验前面所做的那样。 在以后的实验中，您将自己实现传输控制协议，以从不太可靠的数据报中创建可靠的字节流，从而实现此抽象的另一面。





